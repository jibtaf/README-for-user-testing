<!doctype html>
<html>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>

<link href='https://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext' rel='stylesheet' type='text/css' /><style type='text/css'>html {overflow-x: initial !important;}:root { --bg-color: #ffffff; --text-color: #333333; --select-text-bg-color: #B5D6FC; --select-text-font-color: auto; --monospace: "Lucida Console",Consolas,"Courier",monospace; --title-bar-height: 20px; }
.mac-os-11 { --title-bar-height: 28px; }
html { font-size: 14px; background-color: var(--bg-color); color: var(--text-color); font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; -webkit-font-smoothing: antialiased; }
h1, h2, h3, h4, h5 { white-space: pre-wrap; }
body { margin: 0px; padding: 0px; height: auto; inset: 0px; font-size: 1rem; line-height: 1.428571; overflow-x: hidden; background: inherit; tab-size: 4; }
iframe { margin: auto; }
a.url { word-break: break-all; }
a:active, a:hover { outline: 0px; }
.in-text-selection, ::selection { text-shadow: none; background: var(--select-text-bg-color); color: var(--select-text-font-color); }
#write { margin: 0px auto; height: auto; width: inherit; word-break: normal; overflow-wrap: break-word; position: relative; white-space: normal; overflow-x: visible; padding-top: 36px; }
#write.first-line-indent p { text-indent: 2em; }
#write.first-line-indent li p, #write.first-line-indent p * { text-indent: 0px; }
#write.first-line-indent li { margin-left: 2em; }
.for-image #write { padding-left: 8px; padding-right: 8px; }
body.typora-export { padding-left: 30px; padding-right: 30px; }
.typora-export .footnote-line, .typora-export li, .typora-export p { white-space: pre-wrap; }
.typora-export .task-list-item input { pointer-events: none; }
@media screen and (max-width: 500px) {
  body.typora-export { padding-left: 0px; padding-right: 0px; }
  #write { padding-left: 20px; padding-right: 20px; }
}
#write li > figure:last-child { margin-bottom: 0.5rem; }
#write ol, #write ul { position: relative; }
img { max-width: 100%; vertical-align: middle; image-orientation: from-image; }
button, input, select, textarea { color: inherit; font-style: inherit; font-variant-caps: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; font-size-adjust: inherit; font-kerning: inherit; font-variant-alternates: inherit; font-variant-ligatures: inherit; font-variant-numeric: inherit; font-variant-east-asian: inherit; font-variant-position: inherit; font-feature-settings: inherit; font-optical-sizing: inherit; font-variation-settings: inherit; }
input[type="checkbox"], input[type="radio"] { line-height: normal; padding: 0px; }
*, ::after, ::before { box-sizing: border-box; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p, #write pre { width: inherit; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p { position: relative; }
p { line-height: inherit; }
h1, h2, h3, h4, h5, h6 { break-after: avoid-page; break-inside: avoid; orphans: 4; }
p { orphans: 4; }
h1 { font-size: 2rem; }
h2 { font-size: 1.8rem; }
h3 { font-size: 1.6rem; }
h4 { font-size: 1.4rem; }
h5 { font-size: 1.2rem; }
h6 { font-size: 1rem; }
.md-math-block, .md-rawblock, h1, h2, h3, h4, h5, h6, p { margin-top: 1rem; margin-bottom: 1rem; }
.hidden { display: none; }
.md-blockmeta { color: rgb(204, 204, 204); font-weight: 700; font-style: italic; }
a { cursor: pointer; }
sup.md-footnote { padding: 2px 4px; background-color: rgba(238, 238, 238, 0.7); color: rgb(85, 85, 85); border-radius: 4px; cursor: pointer; }
sup.md-footnote a, sup.md-footnote a:hover { color: inherit; text-transform: inherit; text-decoration: inherit; }
#write input[type="checkbox"] { cursor: pointer; width: inherit; height: inherit; }
figure { overflow-x: auto; margin: 1.2em 0px; max-width: calc(100% + 16px); padding: 0px; }
figure > table { margin: 0px; }
thead, tr { break-inside: avoid; break-after: auto; }
thead { display: table-header-group; }
table { border-collapse: collapse; border-spacing: 0px; width: 100%; overflow: auto; break-inside: auto; text-align: left; }
table.md-table td { min-width: 32px; }
.CodeMirror-gutters { border-right-width: 0px; border-right-style: none; border-right-color: currentcolor; background-color: inherit; }
.CodeMirror-linenumber { -webkit-user-select: none; }
.CodeMirror { text-align: left; }
.CodeMirror-placeholder { opacity: 0.3; }
.CodeMirror pre { padding: 0px 4px; }
.CodeMirror-lines { padding: 0px; }
div.hr:focus { cursor: none; }
#write pre { white-space: pre-wrap; }
#write.fences-no-line-wrapping pre { white-space: pre; }
#write pre.ty-contain-cm { white-space: normal; }
.CodeMirror-gutters { margin-right: 4px; }
.md-fences { font-size: 0.9rem; display: block; break-inside: avoid; text-align: left; overflow: visible; white-space: pre; background: inherit; position: relative !important; }
.md-fences-adv-panel { width: 100%; margin-top: 10px; text-align: center; padding-top: 0px; padding-bottom: 8px; overflow-x: auto; }
#write .md-fences.mock-cm { white-space: pre-wrap; }
.md-fences.md-fences-with-lineno { padding-left: 0px; }
#write.fences-no-line-wrapping .md-fences.mock-cm { white-space: pre; overflow-x: auto; }
.md-fences.mock-cm.md-fences-with-lineno { padding-left: 8px; }
.CodeMirror-line, twitterwidget { break-inside: avoid; }
svg { break-inside: avoid; }
.footnotes { opacity: 0.8; font-size: 0.9rem; margin-top: 1em; margin-bottom: 1em; }
.footnotes + .footnotes { margin-top: 0px; }
.md-reset { margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: top; background: 0px 0px; text-decoration: none; text-shadow: none; float: none; position: static; width: auto; height: auto; white-space: nowrap; cursor: inherit; line-height: normal; font-weight: 400; text-align: left; box-sizing: content-box; direction: ltr; }
li div { padding-top: 0px; }
blockquote { margin: 1rem 0px; }
li .mathjax-block, li p { margin: 0.5rem 0px; }
li blockquote { margin: 1rem 0px; }
li { margin: 0px; position: relative; }
blockquote > :last-child { margin-bottom: 0px; }
blockquote > :first-child, li > :first-child { margin-top: 0px; }
.footnotes-area { color: rgb(136, 136, 136); margin-top: 0.714rem; padding-bottom: 0.143rem; white-space: normal; }
#write .footnote-line { white-space: pre-wrap; }
@media print {
  body, html { border: 1px solid transparent; height: 99%; break-after: avoid; break-before: avoid; font-variant-ligatures: no-common-ligatures; }
  #write { margin-top: 0px; border-color: transparent !important; padding-top: 0px !important; padding-bottom: 0px !important; }
  .typora-export * { print-color-adjust: exact; }
  .typora-export #write { break-after: avoid; }
  .typora-export #write::after { height: 0px; }
  .is-mac table { break-inside: avoid; }
  #write > p:nth-child(1) { margin-top: 0px; }
  .typora-export-show-outline .typora-export-sidebar { display: none; }
  figure { overflow-x: visible; }
}
.footnote-line { margin-top: 0.714em; font-size: 0.7em; }
a img, img a { cursor: pointer; }
pre.md-meta-block { font-size: 0.8rem; min-height: 0.8rem; white-space: pre-wrap; background: rgb(204, 204, 204); display: block; overflow-x: hidden; }
p > .md-image:only-child:not(.md-img-error) img, p > img:only-child { display: block; margin: auto; }
#write.first-line-indent p > .md-image:only-child:not(.md-img-error) img { left: -2em; position: relative; }
p > .md-image:only-child { display: inline-block; width: 100%; }
#write .MathJax_Display { margin: 0.8em 0px 0px; }
.md-math-block { width: 100%; }
.md-math-block:not(:empty)::after { display: none; }
.MathJax_ref { fill: currentcolor; }
[contenteditable="true"]:active, [contenteditable="true"]:focus, [contenteditable="false"]:active, [contenteditable="false"]:focus { outline: 0px; box-shadow: none; }
.md-task-list-item { position: relative; list-style-type: none; }
.task-list-item.md-task-list-item { padding-left: 0px; }
.md-task-list-item > input { position: absolute; top: 0px; left: 0px; margin-left: -1.2em; margin-top: calc(1em - 10px); border: medium; }
.math { font-size: 1rem; }
.md-toc { min-height: 3.58rem; position: relative; font-size: 0.9rem; border-radius: 10px; }
.md-toc-content { position: relative; margin-left: 0px; }
.md-toc-content::after, .md-toc::after { display: none; }
.md-toc-item { display: block; color: rgb(65, 131, 196); }
.md-toc-item a { text-decoration: none; }
.md-toc-inner:hover { text-decoration: underline; }
.md-toc-inner { display: inline-block; cursor: pointer; }
.md-toc-h1 .md-toc-inner { margin-left: 0px; font-weight: 700; }
.md-toc-h2 .md-toc-inner { margin-left: 2em; }
.md-toc-h3 .md-toc-inner { margin-left: 4em; }
.md-toc-h4 .md-toc-inner { margin-left: 6em; }
.md-toc-h5 .md-toc-inner { margin-left: 8em; }
.md-toc-h6 .md-toc-inner { margin-left: 10em; }
@media screen and (max-width: 48em) {
  .md-toc-h3 .md-toc-inner { margin-left: 3.5em; }
  .md-toc-h4 .md-toc-inner { margin-left: 5em; }
  .md-toc-h5 .md-toc-inner { margin-left: 6.5em; }
  .md-toc-h6 .md-toc-inner { margin-left: 8em; }
}
a.md-toc-inner { font-size: inherit; font-style: inherit; font-weight: inherit; line-height: inherit; }
.footnote-line a:not(.reversefootnote) { color: inherit; }
.reversefootnote { font-family: ui-monospace, sans-serif; }
.md-attr { display: none; }
.md-fn-count::after { content: "."; }
code, pre, samp, tt { font-family: var(--monospace); }
kbd { margin: 0px 0.1em; padding: 0.1em 0.6em; font-size: 0.8em; color: rgb(36, 39, 41); background: rgb(255, 255, 255); border: 1px solid rgb(173, 179, 185); border-radius: 3px; box-shadow: rgba(12, 13, 14, 0.2) 0px 1px 0px, rgb(255, 255, 255) 0px 0px 0px 2px inset; white-space: nowrap; vertical-align: middle; }
.md-comment { color: rgb(162, 127, 3); opacity: 0.6; font-family: var(--monospace); }
code { text-align: left; vertical-align: initial; }
a.md-print-anchor { white-space: pre !important; border-width: medium !important; border-style: none !important; border-color: currentcolor !important; display: inline-block !important; position: absolute !important; width: 1px !important; right: 0px !important; outline: 0px !important; background: 0px 0px !important; text-decoration: initial !important; text-shadow: initial !important; }
.os-windows.monocolor-emoji .md-emoji { font-family: "Segoe UI Symbol", sans-serif; }
.md-diagram-panel > svg { max-width: 100%; }
[lang="flow"] svg, [lang="mermaid"] svg { max-width: 100%; height: auto; }
[lang="mermaid"] .node text { font-size: 1rem; }
table tr th { border-bottom-width: 0px; border-bottom-style: none; border-bottom-color: currentcolor; }
video { max-width: 100%; display: block; margin: 0px auto; }
iframe { max-width: 100%; width: 100%; border: medium; }
.highlight td, .highlight tr { border: 0px; }
mark { background: rgb(255, 255, 0); color: rgb(0, 0, 0); }
.md-html-inline .md-plain, .md-html-inline strong, mark .md-inline-math, mark strong { color: inherit; }
.md-expand mark .md-meta { opacity: 0.3 !important; }
mark .md-meta { color: rgb(0, 0, 0); }
@media print {
  .typora-export h1, .typora-export h2, .typora-export h3, .typora-export h4, .typora-export h5, .typora-export h6 { break-inside: avoid; }
}
.md-diagram-panel .messageText { stroke: none !important; }
.md-diagram-panel .start-state { fill: var(--node-fill); }
.md-diagram-panel .edgeLabel rect { opacity: 1 !important; }
.md-fences.md-fences-math { font-size: 1em; }
.md-fences-advanced:not(.md-focus) { padding: 0px; white-space: nowrap; border: 0px; }
.md-fences-advanced:not(.md-focus) { background: inherit; }
.typora-export-show-outline .typora-export-content { max-width: 1440px; margin: auto; display: flex; flex-direction: row; }
.typora-export-sidebar { width: 300px; font-size: 0.8rem; margin-top: 80px; margin-right: 18px; }
.typora-export-show-outline #write { --webkit-flex: 2; flex: 2 1 0%; }
.typora-export-sidebar .outline-content { position: fixed; top: 0px; max-height: 100%; overflow: hidden auto; padding-bottom: 30px; padding-top: 60px; width: 300px; }
@media screen and (max-width: 1024px) {
  .typora-export-sidebar, .typora-export-sidebar .outline-content { width: 240px; }
}
@media screen and (max-width: 800px) {
  .typora-export-sidebar { display: none; }
}
.outline-content li, .outline-content ul { margin-left: 0px; margin-right: 0px; padding-left: 0px; padding-right: 0px; list-style: none; overflow-wrap: anywhere; }
.outline-content ul { margin-top: 0px; margin-bottom: 0px; }
.outline-content strong { font-weight: 400; }
.outline-expander { width: 1rem; height: 1.428571rem; position: relative; display: table-cell; vertical-align: middle; cursor: pointer; padding-left: 4px; }
.outline-expander::before { content: ""; position: relative; font-family: Ionicons; display: inline-block; font-size: 8px; vertical-align: middle; }
.outline-item { padding-top: 3px; padding-bottom: 3px; cursor: pointer; }
.outline-expander:hover::before { content: ""; }
.outline-h1 > .outline-item { padding-left: 0px; }
.outline-h2 > .outline-item { padding-left: 1em; }
.outline-h3 > .outline-item { padding-left: 2em; }
.outline-h4 > .outline-item { padding-left: 3em; }
.outline-h5 > .outline-item { padding-left: 4em; }
.outline-h6 > .outline-item { padding-left: 5em; }
.outline-label { cursor: pointer; display: table-cell; vertical-align: middle; text-decoration: none; color: inherit; }
.outline-label:hover { text-decoration: underline; }
.outline-item:hover { border-color: rgb(245, 245, 245); background-color: var(--item-hover-bg-color); }
.outline-item:hover { margin-left: -28px; margin-right: -28px; border-left-width: 28px; border-left-style: solid; border-left-color: transparent; border-right-width: 28px; border-right-style: solid; border-right-color: transparent; }
.outline-item-single .outline-expander::before, .outline-item-single .outline-expander:hover::before { display: none; }
.outline-item-open > .outline-item > .outline-expander::before { content: ""; }
.outline-children { display: none; }
.info-panel-tab-wrapper { display: none; }
.outline-item-open > .outline-children { display: block; }
.typora-export .outline-item { padding-top: 1px; padding-bottom: 1px; }
.typora-export .outline-item:hover { margin-right: -8px; border-right-width: 8px; border-right-style: solid; border-right-color: transparent; }
.typora-export .outline-expander::before { content: "+"; font-family: inherit; top: -1px; }
.typora-export .outline-expander:hover::before, .typora-export .outline-item-open > .outline-item > .outline-expander::before { content: "−"; }
.typora-export-collapse-outline .outline-children { display: none; }
.typora-export-collapse-outline .outline-item-open > .outline-children, .typora-export-no-collapse-outline .outline-children { display: block; }
.typora-export-no-collapse-outline .outline-expander::before { content: "" !important; }
.typora-export-show-outline .outline-item-active > .outline-item .outline-label { font-weight: 700; }
.md-inline-math-container mjx-container { zoom: 0.95; }
mjx-container { break-inside: avoid; }


.CodeMirror { height: auto; }
.CodeMirror.cm-s-inner { background: inherit; }
.CodeMirror-scroll { overflow: auto hidden; z-index: 3; }
.CodeMirror-gutter-filler, .CodeMirror-scrollbar-filler { background-color: rgb(255, 255, 255); }
.CodeMirror-gutters { border-right-width: 1px; border-right-style: solid; border-right-color: rgb(221, 221, 221); background: inherit; white-space: nowrap; }
.CodeMirror-linenumber { padding: 0px 3px 0px 5px; text-align: right; color: rgb(153, 153, 153); }
.cm-s-inner .cm-keyword { color: rgb(119, 0, 136); }
.cm-s-inner .cm-atom, .cm-s-inner.cm-atom { color: rgb(34, 17, 153); }
.cm-s-inner .cm-number { color: rgb(17, 102, 68); }
.cm-s-inner .cm-def { color: rgb(0, 0, 255); }
.cm-s-inner .cm-variable { color: rgb(0, 0, 0); }
.cm-s-inner .cm-variable-2 { color: rgb(0, 85, 170); }
.cm-s-inner .cm-variable-3 { color: rgb(0, 136, 85); }
.cm-s-inner .cm-string { color: rgb(170, 17, 17); }
.cm-s-inner .cm-property { color: rgb(0, 0, 0); }
.cm-s-inner .cm-operator { color: rgb(152, 26, 26); }
.cm-s-inner .cm-comment, .cm-s-inner.cm-comment { color: rgb(170, 85, 0); }
.cm-s-inner .cm-string-2 { color: rgb(255, 85, 0); }
.cm-s-inner .cm-meta { color: rgb(85, 85, 85); }
.cm-s-inner .cm-qualifier { color: rgb(85, 85, 85); }
.cm-s-inner .cm-builtin { color: rgb(51, 0, 170); }
.cm-s-inner .cm-bracket { color: rgb(153, 153, 119); }
.cm-s-inner .cm-tag { color: rgb(17, 119, 0); }
.cm-s-inner .cm-attribute { color: rgb(0, 0, 204); }
.cm-s-inner .cm-header, .cm-s-inner.cm-header { color: rgb(0, 0, 255); }
.cm-s-inner .cm-quote, .cm-s-inner.cm-quote { color: rgb(0, 153, 0); }
.cm-s-inner .cm-hr, .cm-s-inner.cm-hr { color: rgb(153, 153, 153); }
.cm-s-inner .cm-link, .cm-s-inner.cm-link { color: rgb(0, 0, 204); }
.cm-negative { color: rgb(221, 68, 68); }
.cm-positive { color: rgb(34, 153, 34); }
.cm-header, .cm-strong { font-weight: 700; }
.cm-del { text-decoration: line-through; }
.cm-em { font-style: italic; }
.cm-link { text-decoration: underline; }
.cm-error { color: red; }
.cm-invalidchar { color: red; }
.cm-constant { color: rgb(38, 139, 210); }
.cm-defined { color: rgb(181, 137, 0); }
div.CodeMirror span.CodeMirror-matchingbracket { color: rgb(0, 255, 0); }
div.CodeMirror span.CodeMirror-nonmatchingbracket { color: rgb(255, 34, 34); }
.cm-s-inner .CodeMirror-activeline-background { background: inherit; }
.CodeMirror { position: relative; overflow: hidden; }
.CodeMirror-scroll { height: 100%; outline: 0px; position: relative; box-sizing: content-box; background: inherit; }
.CodeMirror-sizer { position: relative; }
.CodeMirror-gutter-filler, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-vscrollbar { position: absolute; z-index: 6; display: none; outline: 0px; }
.CodeMirror-vscrollbar { right: 0px; top: 0px; overflow: hidden; }
.CodeMirror-hscrollbar { bottom: 0px; left: 0px; overflow: auto hidden; }
.CodeMirror-scrollbar-filler { right: 0px; bottom: 0px; }
.CodeMirror-gutter-filler { left: 0px; bottom: 0px; }
.CodeMirror-gutters { position: absolute; left: 0px; top: 0px; padding-bottom: 10px; z-index: 3; overflow-y: hidden; }
.CodeMirror-gutter { white-space: normal; height: 100%; box-sizing: content-box; padding-bottom: 30px; margin-bottom: -32px; display: inline-block; }
.CodeMirror-gutter-wrapper { position: absolute; z-index: 4; background: 0px 0px !important; border: medium !important; }
.CodeMirror-gutter-background { position: absolute; top: 0px; bottom: 0px; z-index: 4; }
.CodeMirror-gutter-elt { position: absolute; cursor: default; z-index: 4; }
.CodeMirror-lines { cursor: text; }
.CodeMirror pre { border-radius: 0px; border-width: 0px; background: 0px 0px; font-family: inherit; font-size: inherit; margin: 0px; white-space: pre; overflow-wrap: normal; color: inherit; z-index: 2; position: relative; overflow: visible; }
.CodeMirror-wrap pre { overflow-wrap: break-word; white-space: pre-wrap; word-break: normal; }
.CodeMirror-code pre { border-right-width: 30px; border-right-style: solid; border-right-color: transparent; width: fit-content; }
.CodeMirror-wrap .CodeMirror-code pre { border-right-width: medium; border-right-style: none; border-right-color: currentcolor; width: auto; }
.CodeMirror-linebackground { position: absolute; inset: 0px; z-index: 0; }
.CodeMirror-linewidget { position: relative; z-index: 2; overflow: auto; }
.CodeMirror-wrap .CodeMirror-scroll { overflow-x: hidden; }
.CodeMirror-measure { position: absolute; width: 100%; height: 0px; overflow: hidden; visibility: hidden; }
.CodeMirror-measure pre { position: static; }
.CodeMirror div.CodeMirror-cursor { position: absolute; visibility: hidden; border-right-width: medium; border-right-style: none; border-right-color: currentcolor; width: 0px; }
.CodeMirror div.CodeMirror-cursor { visibility: hidden; }
.CodeMirror-focused div.CodeMirror-cursor { visibility: inherit; }
.cm-searching { background: rgba(255, 255, 0, 0.4); }
span.cm-underlined { text-decoration: underline; }
span.cm-strikethrough { text-decoration: line-through; }
.cm-tw-syntaxerror { color: rgb(255, 255, 255); background-color: rgb(153, 0, 0); }
.cm-tw-deleted { text-decoration: line-through; }
.cm-tw-header5 { font-weight: 700; }
.cm-tw-listitem:first-child { padding-left: 10px; }
.cm-tw-box { border-style: solid; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-color: inherit; border-top-width: 0px !important; }
.cm-tw-underline { text-decoration: underline; }
@media print {
  .CodeMirror div.CodeMirror-cursor { visibility: hidden; }
}


:root {
    --side-bar-bg-color: #fafafa;
    --control-text-color: #777;
}

@include-when-export url(https://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext);

/* open-sans-regular - latin-ext_latin */
  /* open-sans-italic - latin-ext_latin */
    /* open-sans-700 - latin-ext_latin */
    /* open-sans-700italic - latin-ext_latin */
  html {
    font-size: 16px;
    -webkit-font-smoothing: antialiased;
}

body {
    font-family: "Open Sans","Clear Sans", "Helvetica Neue", Helvetica, Arial, 'Segoe UI Emoji', sans-serif;
    color: rgb(51, 51, 51);
    line-height: 1.6;
}

#write {
    max-width: 860px;
  	margin: 0 auto;
  	padding: 30px;
    padding-bottom: 100px;
}

@media only screen and (min-width: 1400px) {
	#write {
		max-width: 1024px;
	}
}

@media only screen and (min-width: 1800px) {
	#write {
		max-width: 1200px;
	}
}

#write > ul:first-child,
#write > ol:first-child{
    margin-top: 30px;
}

a {
    color: #4183C4;
}
h1,
h2,
h3,
h4,
h5,
h6 {
    position: relative;
    margin-top: 1rem;
    margin-bottom: 1rem;
    font-weight: bold;
    line-height: 1.4;
    cursor: text;
}
h1:hover a.anchor,
h2:hover a.anchor,
h3:hover a.anchor,
h4:hover a.anchor,
h5:hover a.anchor,
h6:hover a.anchor {
    text-decoration: none;
}
h1 tt,
h1 code {
    font-size: inherit;
}
h2 tt,
h2 code {
    font-size: inherit;
}
h3 tt,
h3 code {
    font-size: inherit;
}
h4 tt,
h4 code {
    font-size: inherit;
}
h5 tt,
h5 code {
    font-size: inherit;
}
h6 tt,
h6 code {
    font-size: inherit;
}
h1 {
    font-size: 2.25em;
    line-height: 1.2;
    border-bottom: 1px solid #eee;
}
h2 {
    font-size: 1.75em;
    line-height: 1.225;
    border-bottom: 1px solid #eee;
}

/*@media print {
    .typora-export h1,
    .typora-export h2 {
        border-bottom: none;
        padding-bottom: initial;
    }

    .typora-export h1::after,
    .typora-export h2::after {
        content: "";
        display: block;
        height: 100px;
        margin-top: -96px;
        border-top: 1px solid #eee;
    }
}*/

h3 {
    font-size: 1.5em;
    line-height: 1.43;
}
h4 {
    font-size: 1.25em;
}
h5 {
    font-size: 1em;
}
h6 {
   font-size: 1em;
    color: #777;
}
p,
blockquote,
ul,
ol,
dl,
table{
    margin: 0.8em 0;
}
li>ol,
li>ul {
    margin: 0 0;
}
hr {
    height: 2px;
    padding: 0;
    margin: 16px 0;
    background-color: #e7e7e7;
    border: 0 none;
    overflow: hidden;
    box-sizing: content-box;
}

li p.first {
    display: inline-block;
}
ul,
ol {
    padding-left: 30px;
}
ul:first-child,
ol:first-child {
    margin-top: 0;
}
ul:last-child,
ol:last-child {
    margin-bottom: 0;
}
blockquote {
    border-left: 4px solid #dfe2e5;
    padding: 0 15px;
    color: #777777;
}
blockquote blockquote {
    padding-right: 0;
}
table {
    padding: 0;
    word-break: initial;
}
table tr {
    border: 1px solid #dfe2e5;
    margin: 0;
    padding: 0;
}
table tr:nth-child(2n),
thead {
    background-color: #f8f8f8;
}
table th {
    font-weight: bold;
    border: 1px solid #dfe2e5;
    border-bottom: 0;
    margin: 0;
    padding: 6px 13px;
}
table td {
    border: 1px solid #dfe2e5;
    margin: 0;
    padding: 6px 13px;
}
table th:first-child,
table td:first-child {
    margin-top: 0;
}
table th:last-child,
table td:last-child {
    margin-bottom: 0;
}

.CodeMirror-lines {
    padding-left: 4px;
}

.code-tooltip {
    box-shadow: 0 1px 1px 0 rgba(0,28,36,.3);
    border-top: 1px solid #eef2f2;
}

.md-fences,
code,
tt {
    border: 1px solid #e7eaed;
    background-color: #f8f8f8;
    border-radius: 3px;
    padding: 0;
    padding: 2px 4px 0px 4px;
    font-size: 0.9em;
}

code {
    background-color: #f3f4f4;
    padding: 0 2px 0 2px;
}

.md-fences {
    margin-bottom: 15px;
    margin-top: 15px;
    padding-top: 8px;
    padding-bottom: 6px;
}


.md-task-list-item > input {
  margin-left: -1.3em;
}

@media print {
    html {
        font-size: 13px;
    }
    pre {
        page-break-inside: avoid;
        word-wrap: break-word;
    }
}

.md-fences {
	background-color: #f8f8f8;
}
#write pre.md-meta-block {
	padding: 1rem;
    font-size: 85%;
    line-height: 1.45;
    background-color: #f7f7f7;
    border: 0;
    border-radius: 3px;
    color: #777777;
    margin-top: 0 !important;
}

.mathjax-block>.code-tooltip {
	bottom: .375rem;
}

.md-mathjax-midline {
    background: #fafafa;
}

#write>h3.md-focus:before{
	left: -1.5625rem;
	top: .375rem;
}
#write>h4.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
#write>h5.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
#write>h6.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
.md-image>.md-meta {
    /*border: 1px solid #ddd;*/
    border-radius: 3px;
    padding: 2px 0px 0px 4px;
    font-size: 0.9em;
    color: inherit;
}

.md-tag {
    color: #a7a7a7;
    opacity: 1;
}

.md-toc { 
    margin-top:20px;
    padding-bottom:20px;
}

.sidebar-tabs {
    border-bottom: none;
}

#typora-quick-open {
    border: 1px solid #ddd;
    background-color: #f8f8f8;
}

#typora-quick-open-item {
    background-color: #FAFAFA;
    border-color: #FEFEFE #e5e5e5 #e5e5e5 #eee;
    border-style: solid;
    border-width: 1px;
}

/** focus mode */
.on-focus-mode blockquote {
    border-left-color: rgba(85, 85, 85, 0.12);
}

header, .context-menu, .megamenu-content, footer{
    font-family: "Segoe UI", "Arial", sans-serif;
}

.file-node-content:hover .file-node-icon,
.file-node-content:hover .file-node-open-state{
    visibility: visible;
}

.mac-seamless-mode #typora-sidebar {
    background-color: #fafafa;
    background-color: var(--side-bar-bg-color);
}

.md-lang {
    color: #b4654d;
}

/*.html-for-mac {
    --item-hover-bg-color: #E6F0FE;
}*/

#md-notification .btn {
    border: 0;
}

.dropdown-menu .divider {
    border-color: #e5e5e5;
    opacity: 0.4;
}

.ty-preferences .window-content {
    background-color: #fafafa;
}

.ty-preferences .nav-group-item.active {
    color: white;
    background: #999;
}

.menu-item-container a.menu-style-btn {
    background-color: #f5f8fa;
    background-image: linear-gradient( 180deg , hsla(0, 0%, 100%, 0.8), hsla(0, 0%, 100%, 0)); 
}


 @media print { @page {margin: 0 0 0 0;} body.typora-export {padding-left: 0; padding-right: 0;} #write {padding:0;}}
</style><title>Milestone 3 README</title>
</head>
<body class='typora-export'><div class='typora-export-content'>
<div id='write'  class=''><h1 id='milestone-3-readme'><span>Milestone 3 README</span></h1><div class='md-toc' mdtype='toc'><p class="md-toc-content" role="list"><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n3624"><a class="md-toc-inner" href="#milestone-3-readme">Milestone 3 README</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n3627"><a class="md-toc-inner" href="#team-name"><strong>Team Name</strong></a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n3629"><a class="md-toc-inner" href="#team-id"><strong>Team ID</strong></a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n3631"><a class="md-toc-inner" href="#team-members"><strong>Team Members</strong></a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n3634"><a class="md-toc-inner" href="#proposed-level-of-achievement"><strong>Proposed Level of Achievement</strong></a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n3636"><a class="md-toc-inner" href="#milestone-1"><strong>Milestone 1</strong> </a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n3654"><a class="md-toc-inner" href="#milestone-2"><strong>Milestone 2</strong></a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n3672"><a class="md-toc-inner" href="#milestone-3"><strong>Milestone 3</strong></a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n3695"><a class="md-toc-inner" href="#tech-stack"><strong>Tech Stack</strong></a></span><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n3733"><a class="md-toc-inner" href="#motivation"><strong>Motivation</strong> </a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n3735"><a class="md-toc-inner" href="#aim"><strong>Aim</strong></a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n3745"><a class="md-toc-inner" href="#user-stories"><strong>User Stories</strong></a></span><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n3748"><a class="md-toc-inner" href="#features"><strong>Features</strong></a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n3757"><a class="md-toc-inner" href="#api-descriptions">API Descriptions</a></span><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n3844"><a class="md-toc-inner" href="#architecture"><strong>Architecture</strong></a></span><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n3848"><a class="md-toc-inner" href="#design-decision"><strong>Design Decision</strong></a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n3850"><a class="md-toc-inner" href="#1-hertz-used-to-build-http-server-api-gateway"><strong>1. Hertz used to build HTTP server (API Gateway)</strong></a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n3852"><a class="md-toc-inner" href="#2-http-requests-encoded-in-json"><strong>2. HTTP Requests Encoded in JSON</strong></a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n3854"><a class="md-toc-inner" href="#3-translation-of-json-requests-to-thrift-binary-format"><strong>3. Translation of JSON Requests to Thrift Binary Format</strong></a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n3856"><a class="md-toc-inner" href="#4-kitex-used-to-build-rpc-servers"><strong>4. Kitex used to build RPC servers</strong></a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n3858"><a class="md-toc-inner" href="#5-load-balancing-for-request-distribution"><strong>5. Load Balancing for Request Distribution</strong></a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n3860"><a class="md-toc-inner" href="#6-service-registry-and-discovery-with-kitex"><strong>6. Service Registry and Discovery with Kitex</strong></a></span><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n3863"><a class="md-toc-inner" href="#usage-instruction"><strong>Usage Instruction</strong></a></span><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n3879"><a class="md-toc-inner" href="#implementation-details"><strong>Implementation Details</strong></a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n3881"><a class="md-toc-inner" href="#1-rpc-servers-built-with-kitex"><strong>1. RPC Servers Built with Kitex:</strong></a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n3893"><a class="md-toc-inner" href="#2-http-server-built-with-hertz"><strong>2. HTTP Server Built with Hertz:</strong></a></span><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n3908"><a class="md-toc-inner" href="#software-engineering-principles"><strong>Software Engineering Principles</strong></a></span><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n3926"><a class="md-toc-inner" href="#testings"><strong>Testings</strong></a></span><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n3994"><a class="md-toc-inner" href="#benchmarking--performance-analysis"><strong>Benchmarking &amp; Performance Analysis</strong></a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n4016"><a class="md-toc-inner" href="#interpreting-the-callgraph">Interpreting the Callgraph</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n4053"><a class="md-toc-inner" href="#side-note">Side Note</a></span><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n4057"><a class="md-toc-inner" href="#future-development"><strong>Future development</strong> </a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n4063"><a class="md-toc-inner" href="#timeline"><strong>Timeline</strong></a></span></p></div><h2 id='team-name'><strong><span>Team Name</span></strong></h2><p><strong><span>Escaping With U</span></strong></p><h2 id='team-id'><strong><span>Team ID</span></strong></h2><p><strong><span>5594</span></strong></p><h2 id='team-members'><strong><span>Team Members</span></strong></h2><p><strong><span>He Yifan</span></strong></p><p><strong><span>Li Xinyan</span></strong></p><h2 id='proposed-level-of-achievement'><strong><span>Proposed Level of Achievement</span></strong></h2><p><strong><span>Project Gemini (Tiktok Project)</span></strong></p><h2 id='milestone-1'><strong><span>Milestone 1</span></strong><span> </span></h2><ul><li><p><strong><span>Poster:</span></strong></p><ul><li><p><strong><a href='https://drive.google.com/file/d/1LcKahANW4h8PetDVYRJC_YWCzDt6EHpB/view?usp=sharing'><span>5594_Milestone_1.png</span></a></strong></p></li></ul></li><li><p><strong><span>Video:</span></strong></p><ul><li><p><strong><a href='https://drive.google.com/file/d/1sztCGiXxeVAxFDJ5scPrAp7vgk3mvrgj/view?usp=sharing'><span>5594_Milstone_1.mov</span></a></strong></p></li></ul></li><li><p><strong><span>Project Log:</span></strong></p><ul><li><p><strong><a href='https://drive.google.com/file/d/1I6P0bxJPMF8nLCauO6YBYoqSaxRYZsrC/view?usp=sharing'><span>5594_Milestone1_Project_Log.pdf</span></a></strong></p></li></ul></li></ul><h2 id='milestone-2'><strong><span>Milestone 2</span></strong></h2><ul><li><p><strong><span>Poster:</span></strong></p><ul><li><p><strong><a href='https://drive.google.com/file/d/1i2tYXq_DAvd5mvhKGNW2TlIYGaPOHPmR/view?usp=sharing'><span>5594_Milestone2_Poster.png</span></a></strong></p></li></ul></li><li><p><strong><span>Video:</span></strong></p><ul><li><p><strong><a href='https://drive.google.com/file/d/1YuPRWVz1LxCUMO2R3pJaFnxStuEuPVu7/view?usp=sharing'><span>5594_Milstone_2.mp4</span></a></strong></p></li></ul></li><li><p><strong><span>Project Log:</span></strong></p><ul><li><p><strong><a href='https://drive.google.com/file/d/1Euo4TYliiQd_SyGdlSMEhtMQfPhb2YC4/view?usp=sharing'><span>5594_Milestone2_Project_Log.pdf</span></a></strong></p></li></ul></li></ul><h2 id='milestone-3'><strong><span>Milestone 3</span></strong></h2><ul><li><p><strong><span>Link to executable files:</span></strong><span> </span></p><ul><li><p><strong><a href='https://drive.google.com/drive/folders/115Memb2WfJusZ6Rt71P85IXIigN5wXFw?usp=sharing'><span>5594_Executable_Files</span></a></strong></p></li></ul></li><li><p><strong><span>Poster:</span></strong></p><ul><li><p><strong><a href='https://drive.google.com/file/d/1r8XjiWtWK1JFtIT-9uhUL6JDzLaf_cHv/view?usp=sharing'><span>5594_Milestone3_Poster.png</span></a></strong></p></li></ul></li><li><p><strong><span>Video:</span></strong></p><ul><li><p><strong><a href='https://drive.google.com/file/d/19cGmvQFT3CSOfpMklNhEt-G0G8XAlnVF/view?usp=sharing'><span>5594_Milstone_3.mp4</span></a></strong></p></li></ul></li><li><p><strong><span>Project Log:</span></strong></p><ul><li><p><strong><a href='https://drive.google.com/file/d/1QHxq5Z0Na4Wv0__zCKG6QYr6yJuSWn9M/view?usp=sharing'><span>5594_Milestone3_Project_Log.pdf</span></a></strong></p></li></ul></li></ul><h2 id='tech-stack'><strong><span>Tech Stack</span></strong></h2><ul><li><p><strong><span>Go</span></strong><span> </span></p><ul><li><p><strong><span>The Primary language used for building the API Gateway.</span></strong></p></li></ul></li><li><p><strong><span>Kitex</span></strong></p><ul><li><p><strong><span>Framework for building backend RPC servers.</span></strong></p></li></ul></li><li><p><strong><span>Hertz</span></strong></p><ul><li><p><strong><span>Framework for building HTTP servers(the API Gateway itself).</span></strong></p></li></ul></li><li><p><strong><span>GitHub</span></strong></p><ul><li><p><strong><span>Source Control</span></strong></p></li></ul></li><li><p><strong><span>JSON data interchange format</span></strong></p><ul><li><p><strong><span>Encoding and decoding data.</span></strong></p></li></ul></li><li><p><strong><span>HTTP</span></strong></p><ul><li><p><strong><span>Request and response structure, HTTP methods, and status codes.</span></strong></p></li></ul></li><li><p><strong><span>Apache Thrift</span></strong></p><ul><li><p><strong><span>Interface Definition Language(IDL) and binary communication protocol.</span></strong></p></li></ul></li></ul><h1 id='motivation'><strong><span>Motivation</span></strong><span> </span></h1><p><span>As two passionate year 1 students with a keen interest in TikTok, this opportunity allows us to dive deep into the TikTok community while building an API gateway based on CloudWeGo. Through this project, we eagerly anticipate gaining practical knowledge in Golang, HTTP, JSON, Thrift, and more. Moreover, it offers us hands-on experience in creating HTTP and RPC servers, honing our skills in crucial backend development concepts and technologies. As we embark on this learning journey, our goal is to develop a solid foundation that will propel us further in our backend development endeavours.</span></p><h2 id='aim'><strong><span>Aim</span></strong></h2><p><span>We aim to implement an API gateway that accepts HTTP requests encoded in JSON format, and uses the Generic-Call feature of Kitex to translate these requests into Thrift binary format requests. The API Gateway will then forward the request to one of the backend RPC servers discovered from the registry centre.</span></p><p><span>And there are some criteria for this API Gateway:</span></p><ol start='' ><li><p><span>The API Gateway should provide a centralised entry point for incoming requests. It should support routing of requests to the appropriate microservices based on defined rules or configurations.</span></p></li><li><p><span>The API Gateway should handle request authentication and authorization, ensuring secure communication between clients and microservices.</span></p></li><li><p><span>It should support request transformation and data mapping between clients and microservices, if required.</span></p></li></ol><h2 id='user-stories'><strong><span>User Stories</span></strong></h2><p><span>Once upon a time, two developers relied on CloudWeGo for their projects. They desired an API Gateway feature to efficiently manage request transmission and build a comprehensive set of microservices systems. Working closely with CloudWeGo&#39;s team, the feature was developed, empowering users to streamline communication between microservices. With its seamless integration, developers found increased performance, stability, and scalability. This innovation sparked a thriving community, sharing experiences and transforming the world of microservices development.</span></p><p>&nbsp;</p><h1 id='features'><strong><span>Features</span></strong></h1><ol start='' ><li><h2 id='http-server-built-by-hertz'><span>HTTP server built by Hertz </span></h2></li></ol><p><span>The API Gateway is implemented with Hertz, following the IDL file named </span><strong><span>gateway.thrift</span></strong></p><p><img src="/Users/heyifan/Desktop/Xnip2023-07-27_18-32-24.jpg" alt="Xnip2023-07-27_18-32-24" style="zoom:50%;" /></p><p><strong><span>This IDL file defines the interfaces for the API services, which are then implemented by the handlers.</span></strong></p><p><strong><img src="/Users/heyifan/Library/Application Support/typora-user-images/Screenshot 2023-07-26 at 12.37.08.png" alt="Screenshot 2023-07-26 at 12.37.08" style="zoom: 50%;" /></strong></p><p><span>The API Gateway also registers all the routers based on the </span><code>api.${HTTP Method}</code><span> annotation in the IDL. </span></p><h3 id='api-descriptions'><span>API Descriptions</span></h3><ul><li><p><code>SayHello</code><span>  </span><code>localhost:8080/hello</code></p><ul><li><p><span>Request should use a </span><code>GET</code><span> method and have a JSON body representing an instance of the following struct:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="go"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="go"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">type</span> <span class="cm-variable">User</span> <span class="cm-keyword">struct</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-variable">Id</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">string</span> <span class="cm-string">`json:"id"`</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-variable">Name</span> &nbsp; &nbsp;<span class="cm-keyword">string</span> <span class="cm-string">`json:"name"`</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-variable">Avatar</span> &nbsp;<span class="cm-keyword">string</span> <span class="cm-string">`json:"avatar"`</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-variable">Address</span> <span class="cm-keyword">string</span> <span class="cm-string">`json:"address"`</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-variable">Mobile</span> &nbsp;<span class="cm-keyword">string</span> <span class="cm-string">`json:"mobile"`</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 154px;"></div><div class="CodeMirror-gutters" style="display: none; height: 154px;"></div></div></div></pre></li><li><p><span>Response will have a JSON body representing an instance of the following struct:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="go"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="go"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">type</span> <span class="cm-variable">Response</span> <span class="cm-keyword">struct</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-variable">ErrCode</span> <span class="cm-keyword">int32</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">`json:"errCode"`</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-variable">ErrMsg</span> &nbsp;<span class="cm-keyword">string</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-string">`json:"errMsg"`</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-variable">Data</span> &nbsp; &nbsp;<span class="cm-keyword">map</span>[<span class="cm-keyword">string</span>]<span class="cm-operator">*</span><span class="cm-variable">User</span> <span class="cm-string">`json:"data"`</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 110px;"></div><div class="CodeMirror-gutters" style="display: none; height: 110px;"></div></div></div></pre><p><span>where the </span><code>Data</code><span> is a map with a Key </span><code>“User”</code><span> and the corresponding Value is the </span><code>User</code><span> instance sent by the request.</span></p></li></ul></li><li><p><code>InsertUser</code><span>  </span><code>localhost:8080/user/insert</code></p><ul><li><p><span>Request should use a </span><code>POST</code><span> method and have a JSON body with the same format as above.</span></p></li><li><p><span>Response will also be as the same format as above.</span></p></li></ul></li><li><p><code>InsertProduct</code><span>  </span><code>localhost:8080/product/insert</code></p><ul><li><p><span>Request should use a </span><code>POST</code><span> method and have a JSON body representing an instance of the following struct:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="go"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="go"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">type</span> <span class="cm-variable">Product</span> <span class="cm-keyword">struct</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-variable">Id</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">string</span> <span class="cm-string">`json:"id"`</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-variable">Name</span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">string</span> <span class="cm-string">`json:"name"`</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-variable">Description</span> <span class="cm-keyword">string</span> <span class="cm-string">`json:"description"`</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-variable">Amount</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">string</span> <span class="cm-string">`json:"amount"`</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 132px;"></div><div class="CodeMirror-gutters" style="display: none; height: 132px;"></div></div></div></pre></li><li><p><span>Response will have a JSON body representing an instance of the following struct:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="go"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="go"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">type</span> <span class="cm-variable">Response</span> <span class="cm-keyword">struct</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-variable">ErrCode</span> <span class="cm-keyword">int32</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">`json:"errCode"`</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-variable">ErrMsg</span> &nbsp;<span class="cm-keyword">string</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-string">`json:"errMsg"`</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-variable">Data</span> &nbsp; &nbsp;<span class="cm-keyword">map</span>[<span class="cm-keyword">string</span>]<span class="cm-operator">*</span><span class="cm-variable">Product</span> <span class="cm-string">`json:"data"`</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 110px;"></div><div class="CodeMirror-gutters" style="display: none; height: 110px;"></div></div></div></pre><p><span>where the </span><code>Data</code><span> is a map with a Key </span><code>“Product”</code><span> and the corresponding Value is the </span><code>Product</code><span> instance sent by the request.</span></p></li></ul></li><li><p><code>Pingpong</code><span>  </span><code>localhost:8080/hello</code></p><ul><li><p><span>Request should use a </span><code>GET</code><span> method and have a JSON body:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="json"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="json"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-string cm-property">"ping"</span>: <span class="cm-variable">ANY</span> <span class="cm-variable">STRING</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 66px;"></div><div class="CodeMirror-gutters" style="display: none; height: 66px;"></div></div></div></pre></li><li><p><span>Response will have a JSON body representing an instance of the following struct:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="go"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="go"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">type</span> <span class="cm-variable">Response</span> <span class="cm-keyword">struct</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-variable">ErrCode</span> <span class="cm-keyword">int32</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">`json:"errCode"`</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-variable">ErrMsg</span> &nbsp;<span class="cm-keyword">string</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-string">`json:"errMsg"`</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 88px;"></div><div class="CodeMirror-gutters" style="display: none; height: 88px;"></div></div></div></pre><p><span>where the </span><code>ErrMsg</code><span> is a string </span><code>“Pong”</code></p></li></ul></li><li><p><code>QueryUser</code><span>  </span><code>localhost:8080/user/query</code><span>  </span><code>GET</code></p></li><li><p><code>QueryProduct</code><span>   </span><code>localhost:8080/product/query</code><span>  </span><code>GET</code></p><ul><li><p><span>Above two methods are not implemented due to a lack of database. Request can be a simple JSON object with an “id”, and the response will contain the testUser and testProduct.</span></p></li></ul></li></ul><ol start='2' ><li><h2 id='generic-call-feature-of-kitex'><span>Generic-Call feature of Kitex</span></h2></li></ol><p><img src="https://lh5.googleusercontent.com/0b9hp15g3gdB9FKogHYqUE4j0iMlS0i18REOQX9QMQndHyEeShe-IP-dQHJdbd-jrmbgyn4gBXZGNOISIl9numozLYVsK_QPSt40kVgvuJ-gTIdIVVeZ8SIam_MFeBlnsnbKWPyMiWVv-VnWG9bn_LU" alt="img" style="zoom: 50%;" />
<span>The API Gateway translates HTTP requests encoded in JSON format from the client to Thrift binary format, using the JSON Mapping Generic-Call feature of Kitex.</span></p><p><span>JSON Mapping Generic Call means that the user can directly construct JSON string request or response according to the specification, and Kitex will do Thrift codec accordingly.</span></p><p><span>The </span><code>generic.NewThriftFileProvider()</code><span> function finds the IDL file which defines the RPC services according to the given filePath, and parses the IDL files. Then the </span><code>generic.JSONThriftGeneric()</code><span> provides the </span><code>Generic</code><span> parameter for </span><code>genericclient.NewClient()</code><span> to create a generic client to call the </span><code>destService</code><span>.</span></p><p><span>E.g., the </span><code>SayHello(context.Context, *app.RequestContext)</code><span> function in </span><strong><span>gateway_service.go</span></strong><span> reads the IDL file defining services for the user server at </span><code>uServicePath = ./idl/server_idl/u_service.thrift</code><span>, and creates a generic client to call the </span><code>SayHello(context.Context, string) (*user_server.Response, error)</code><span> destService.</span></p><p><img src="https://lh3.googleusercontent.com/6Z3avs4YA610H87vRaeLDYRQ9-JkudtKG29CMkPo5SRu-A76BsDLCALPJvHIN-fMqJW2jyEWw347oZCPZr6QBC1nhpUfN4XWA7wy8LCrzxx1JpgCQzNsXfF8tsZPunX1nnwKeLDKTjxi-BLcXJwebzY" alt="img" style="zoom:50%;" /><img src="https://lh4.googleusercontent.com/dBdZIVHt1b2XlCoK2mx7HJSyGjGxrS6fY2birj3S9IyHMPIuJGnOFaSkacjQq28dKjjuwWBxzHkymRMMFtyyMfOzUmroTH9qgYAKkmkCY8ZDOxFYpKeiv0lCFuLzWoyF3GnLaACXa4TNRKtE3KY15Y8" alt="img" style="zoom:50%;" /></p><ol start='3' ><li><h2 id='rpc-servers-built-by-kitex'><span>RPC servers built by Kitex</span></h2></li></ol><p><img src="https://lh6.googleusercontent.com/JeCB57ihSEy5tVi2a4tFwJxcYAlH5APvoa_hQHF1fb10xvGr_d9Dv-Up4ClIGWB6G6DVUfvZJlISMUr3Mq4wR9N8AYqD74EdOCCh3P1mrdAKZY_hzWnsVJ8q3VSmZMSEwg9U4jeaCuU81Gnw5BZuQDM" alt="img" style="zoom:50%;" /><img src="https://lh4.googleusercontent.com/2HgMSBNXHWV6sGX3t-sPr2c1TqZcwMUPRCajdSJNg9wSfEdtGOewFVXwkH06ZMyDfzqVo_T0qVSkZPKsMorGV2k6rvnbyttFmm4abnlpxcQbN3c3XMt1u4pxOzbnGnN7-IysfeKmdu08W6QKmVe8hU8" alt="img" style="zoom: 60%;" /></p><p><span>We have built a user server and a product server for testing purposes. They provide the services that can be called via RPC calls from the API Gateway, such as </span><code>SayHello()</code><span>, </span><code>InsertUser()</code><span> and </span><code>InsertProduct()</code><span>.</span></p><p><img src="https://lh5.googleusercontent.com/Xrq5YmpE6EoIIurL5D-zgr1pA9yDpHKu_gSUnETAwFrK7v0GSHWBs06rRKAFGYvNvW2K46pTQXzpFrn8-VERiLkT-RTiJMedPs2BhLdPt6djbWM_Nyiaigq-MlUtsRtFGLjy6W6VNIZc3281moQxGo0" alt="img" style="zoom:60%;" /><img src="https://lh3.googleusercontent.com/XOlMyY1TB45scWDG4Tf2xqc07vm44l6XL4CLQ2LVuBOMgYs7ToLUbExT1aN9E9U0Nh_7WCDZxQuXvMYaXXVXoP2dh1d9qLShZg_RoCduJrtlsVjV1HoXHiYF1zTFuDMF3BNlOWM52KcWat_6gvnKodQ" alt="img" style="zoom:60%;" /><img src="https://lh5.googleusercontent.com/sQfEeSXqZzNGlTzMmQizAhUFz6tP8f7oHVA7Nlxgmk6PACUTo32lKF_96YUEnSwM_3TP8tjR3v0h4JgHmWzgY_WNhU1WQGHVeRdndmtkXdbpCiiNLQSk_JT0FpKBDRzS28n3YUIIzuMkTKOE6dzGZKY" alt="img" style="zoom:60%;" /></p><p><span>These services will return a Response instance comprising a </span><strong><span>status code</span></strong><span> (200 if the function returns with no error), a piece of </span><strong><span>message</span></strong><span> and the </span><strong><span>data</span></strong><span> being transmitted (either a user instance or a product instance). The response will then be sent back to the API Gateway and be JSON serialised as the body of the response to the initial HTTP request.</span></p><ol start='4' ><li><h2 id='load-balancing'><span>Load balancing</span></h2></li></ol><p><img src="https://lh6.googleusercontent.com/BHbLBjnNU_mm_3SmnT7LGzi-FFV2dRtk7VFG0AEbKIpLmtDrTpQYUvlqgn6BmJ925M0QUnCe80bFCpADVMwC-CZgDb3Ayo8fPIrPIciWoBDti8KiY8VHq5L43FpFvy0IhI_LWStXdtoqo4QKqi-y-ec" referrerpolicy="no-referrer" alt="img">
<span>Load balancing manages the request distribution, which can evenly distribute requests among available backend RPC servers.</span></p><ol start='5' ><li><h2 id='service-register-and-discoveryconsul'><span>Service Register and Discovery(consul)</span></h2></li></ol><p><span>We are using </span><strong><span>consul</span></strong><span> for service registry and discovery. </span></p><p><span>“Consul is a distributed, highly-available, and multi-datacenter aware tool for service discovery, configuration, and orchestration. Consul enables rapid deployment, configuration, and maintenance of service-oriented architectures at massive scale.”</span></p><p><img src="https://lh5.googleusercontent.com/cDUhiKzMgdlMeXauKKV0J6TIVUs04i7gLAGkEdFHoetMKmxd5Ol5QJt-dZ02zixM7J1mr9aRhHlY-Xxeflyaql0ddyh8LrAOEV8MEnJulMWCG5sYzBUKnjojHJ20qTfSVFWxAaF3vYOC2a-Grw-fPt0" referrerpolicy="no-referrer" alt="img">
<img src="https://lh3.googleusercontent.com/DRgro7abRrIflF24-pJP405cLMNRVgz2Bl4xl-prGxa0dHcSbUIrPiVEKtLSVLLMQ_RNwEWd-WznSD1uwMz44wPZ2pbJyukNFB0o-0ZS6EYDpWd-xWnzCOl6oODULAm3AkZLGzLv8HEv6F42y6IV2k0" referrerpolicy="no-referrer" alt="img"></p><p><span>When creating the generic client for generic call, it is provided with an option to have a consul resolver to connect to the consul server at </span><code>127.0.0.1:8500</code><span> for service discovery.</span></p><p><img src="https://lh5.googleusercontent.com/RLSO7gsNoMtfZnWg0YCAhjgh9zticEeRcuV0u4jlFn6rWeloOu1JW5gs25vZz3z1h7qPMaABG1_tbsRY7HRtY0qyLai6dm5XkZgK01JsRo-oD0yjAbs5IbzE93Ufct7QvocOXWAC-0uA8xcYB1KHZzE" alt="img" style="zoom:50%;" /></p><p><span>Meanwhile, each Kitex server is equipped with the consul register at </span><code>127.0.0.1:8500</code><span>. Upon running the server, its services will be registered and will be discoverable by the API Gateway.</span></p><ol start='6' ><li><h2 id='a-mechanism-for-updating-the-relationship-between-services-and-idls-ensuring-that-the-api-gateway-can-adapt-to-changes-in-case-of-new-services-and-idl-updates-promoting-flexibility-and-maintainability-within-the-project'><span>A mechanism for updating the relationship between services and IDLs, ensuring that the API Gateway can adapt to changes in case of new services and IDL updates, promoting flexibility and maintainability within the project.</span></h2></li></ol><p><span>This mechanism is implemented under </span><strong><span>hertz_server/fileChange.go</span></strong><span>.</span></p><p><img src="https://lh3.googleusercontent.com/oDPcZu53Es98lc7Ub8P19agVgYlFs5MFw-ydLJDyjMXqQ1br1c9EOQkFXETwWPOjnwblTmrKyyO5DDZQDWIa39LqpoL94-bEwK_2-kmt9fkhHitoLApQW8_5D4R4Xi1RXkpj3n17C4-OLSz4HYkvicU" alt="img" style="zoom:50%;" /></p><p><span>First, the </span><code>NewWatcher()</code><span> function reads the status of the IDL file at the given filePath, and watches for any changes in the status, such as the file size and modification time, once every second. If a change is observed, it will call </span><code>hzUpdate()</code><span> with the script file </span><code>“updateIDL.sh”</code><span>.</span></p><p><img src="https://lh3.googleusercontent.com/tX1Clq1GcaLE7afZihflMmW-HXBs4dwJIIwReE7k0Cb2IuUJT3jVtnW1wN2vc7-d8sVucCx-VsaspfOebr1m1gvZBJbO5gQbbZZeeVSKqnXC_JurON7Pb9BLjQAItJAcg_fgFDh-Km5vgHbvxppAK2k" alt="img" style="zoom:50%;" /></p><p><span>The </span><code>hzUpdate()</code><span> function will execute the commands inside the </span><code>“updateIDL.sh”</code><span> file:</span></p><p><img src="https://lh6.googleusercontent.com/EoN7qZ-IQ-JVGjktJXlvl8WP_cn1NX9k9mads1OHrbzNjCHIVVtXcIHoMgYlz6394UJ4QyMfupCH3o4kcwe_wOd6JOAy3r7WtWA5zwAcAvioTlYFNilMwAsvekabdmkLti2nrMXNhpCJmIiLTz1l0DE" alt="img" style="zoom:50%;" /></p><p><code>“hz update -idl ./idl/gateway.thrift”</code><span> runs the Hertz command line tool to update the API Gateway according to the IDL file.</span></p><p><code>“go build”</code><span> re-generates the API Gateway executable binary file.</span></p><p><img src="https://lh4.googleusercontent.com/XIiI9PbkCHRN1SzfqYcY4rqPxclOkl5qmWcDaIbWuIKNEDxiNOzLr05gG1mQ4r9W1btv1NOHmb8J2rhiH-rOsao_4zn_-S-lf9Tetz9zSxrUeCw4IiG9ro26saIwZP4FErr4MSUK3CHJE_mblh1OH64" alt="img" style="zoom:50%;" /></p><p><span>Then, this mechanism is encapsulated into the UpdateIDL() function, and is run on a separate goroutine, which ensures the update is executed asynchronously, so that the API Gateway is not affected.</span></p><h1 id='architecture'><strong><span>Architecture</span></strong></h1><p><img src="https://lh5.googleusercontent.com/0xHtOB2uM-zvrUhcekQOm73ow3EP_Njfv1w9uVu_Vwl9Up9KLA3zx7flgEE-oRtkKuK8D2WAe-FIAAeYp5nbRiQHFgGWqMjvK-NU8pgCkTF_yz6DhPoP3X6rWdhYwZRvyr136XwKZzCLvKDdd6xMwqU" alt="img" style="zoom:50%;" /></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">.</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">├── README.md &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  // README file for GitHub repository</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">├── docs</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">│&nbsp;&nbsp; └── diagram.png</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">├── hertz_server &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Code for the API GAteway</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">│&nbsp;&nbsp; ├── biz<span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span> // Business logics, including handlers</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">│&nbsp;&nbsp; ├── build.sh</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">│&nbsp;&nbsp; ├── fileChange.go<span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span> // Mechanism to update the gateway if there is a change in idl</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">│&nbsp;&nbsp; ├── gateway<span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span> // Executable binary file</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">│&nbsp;&nbsp; ├── gateway_test.go<span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-tab" role="presentation" cm-text="	">  </span> // Unit tests</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">│&nbsp;&nbsp; ├── go.mod</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">│&nbsp;&nbsp; ├── go.sum</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">│&nbsp;&nbsp; ├── idl<span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span> // Directory for idl files</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">│&nbsp;&nbsp; ├── kitex_gen</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">│&nbsp;&nbsp; ├── main.go</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">│&nbsp;&nbsp; ├── router.go</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">│&nbsp;&nbsp; ├── router_gen.go</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">│&nbsp;&nbsp; ├── script</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">│&nbsp;&nbsp; └── updateIDL.sh</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">├── kitex_servers<span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span> // Directory for Kitex RPC servers</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">│&nbsp;&nbsp; ├── pingpong</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">│&nbsp;&nbsp; ├── product_server</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">│&nbsp;&nbsp; ├── user_server</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">│&nbsp;&nbsp; ├── user_server2</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">│&nbsp;&nbsp; └── user_server3</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">├── testProduct.json</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">└── testUser.json</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 594px;"></div><div class="CodeMirror-gutters" style="display: none; height: 594px;"></div></div></div></pre><p>&nbsp;</p><h1 id='design-decision'><strong><span>Design Decision</span></strong></h1><p><span>In the implementation of the API Gateway project, our team has made several design decisions regarding the technology stack and request handling mechanisms. These decisions have been carefully chosen to ensure high-performance, scalability, and efficient communication between microservices. The key design decisions are as follows:</span></p><h2 id='1-hertz-used-to-build-http-server-api-gateway'><strong><span>1. Hertz used to build HTTP server (API Gateway)</span></strong></h2><p><span>For the implementation of the API Gateway itself, we have opted for Hertz, a framework specifically designed for building HTTP servers. Hertz provides the necessary tools and utilities to create robust and performant HTTP endpoints, enabling the API Gateway to efficiently handle incoming HTTP requests from clients. Also, the Hertz framework provides a command line tool called hz for generating scaffolding for Hertz projects based on Thrift IDL.</span></p><h2 id='2-http-requests-encoded-in-json'><strong><span>2. HTTP Requests Encoded in JSON</span></strong></h2><p><span>To ensure compatibility and ease of use, the API Gateway accepts incoming HTTP requests encoded in JSON format. JSON is a widely adopted data interchange format that allows for easy encoding and decoding of data in a human-readable and machine-readable manner. By accepting JSON requests, the API Gateway can seamlessly communicate with clients and microservices, simplifying data exchange.</span></p><h2 id='3-translation-of-json-requests-to-thrift-binary-format'><strong><span>3. Translation of JSON Requests to Thrift Binary Format</span></strong></h2><p><span>Upon receiving JSON-encoded requests, the API Gateway employs the Generic-Call feature of Kitex to translate these requests into Thrift binary format. Thrift is an Interface Definition Language (IDL) and binary communication protocol, known for its efficiency and compactness. By converting JSON requests to Thrift binary format, the API Gateway can reduce the overhead of data transmission and improve overall performance.</span></p><h2 id='4-kitex-used-to-build-rpc-servers'><strong><span>4. Kitex used to build RPC servers</span></strong></h2><p><span>We have chosen Kitex as the primary Golang RPC framework to build the RPC servers. Kitex is renowned for its high-performance and strong-extensibility, making it an ideal choice for building efficient and reliable RPC-based services. By utilising Kitex, it is ensured that the RPC servers can handle a large number of concurrent requests, facilitating seamless communication between microservices.</span></p><h2 id='5-load-balancing-for-request-distribution'><strong><span>5. Load Balancing for Request Distribution</span></strong></h2><p><span>To ensure optimal utilisation of backend RPC servers and avoid overloading any specific instance, the API Gateway incorporates load balancing mechanisms. Load balancing evenly distributes incoming requests among the available backend RPC servers. This enables efficient utilisation of resources and ensures that the system can handle varying loads without bottlenecks.</span></p><h2 id='6-service-registry-and-discovery-with-kitex'><strong><span>6. Service Registry and Discovery with Kitex</span></strong></h2><p><span>Kitex provides a service registration and discovery mechanism, allowing backend RPC servers to register themselves within the register centre. The API Gateway can then discover and locate these services dynamically. By leveraging Kitex-based service register and discovery, the API Gateway can efficiently manage and route requests to the appropriate backend services, ensuring seamless communication and load distribution.</span></p><p><span>These design decisions collectively contribute to the creation of a high-performance, scalable, and robust API Gateway. By combining Kitex and Hertz for building RPC and HTTP servers, respectively, and integrating load balancing and service discovery mechanisms, the team aims to deliver an efficient and reliable solution for request handling and communication between microservices.</span></p><h1 id='usage-instruction'><strong><span>Usage Instruction</span></strong></h1><p><strong><mark><span>Docker is needed</span></mark></strong></p><ol start='' ><li><p><span>First, set up the consul server for service registry:</span></p></li></ol><p><code>docker pull hashicorp/consul</code></p><p><code>docker run -d -p 8500:8500 hashicorp/consul consul agent -dev -client=0.0.0.0</code></p><ol start='2' ><li><p><span>Then, download the executable files from </span><a href='https://drive.google.com/drive/folders/115Memb2WfJusZ6Rt71P85IXIigN5wXFw?usp=sharing'><span>5594_Executable_Files</span></a><span>, and execute them to run the server:</span></p></li><li><p><span>Finally, use Postman or other tools to send the requests to </span><code>0.0.0.0:8080</code><span>.</span></p></li></ol><p><span>e.g. Send a GET request to </span><code>0.0.0.0:8080/hello</code><span> with the following JSON body:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="json"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="json"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-string cm-property">"user"</span>: {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string cm-property">"id"</span>: <span class="cm-string">"1"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string cm-property">"name"</span>: <span class="cm-string">"Aaron"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string cm-property">"avatar"</span>: <span class="cm-string">"IronMan"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string cm-property">"address"</span>: <span class="cm-string">"NUS"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string cm-property">"mobile"</span>: <span class="cm-string">"99999999"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 198px;"></div><div class="CodeMirror-gutters" style="display: none; height: 198px;"></div></div></div></pre><p><span>Send a POST request to 0.0.0.0:8080/product/insert with the following JSON body:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="json"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="json"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-string cm-property">"product"</span>: {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string cm-property">"id"</span>: <span class="cm-string">"1"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string cm-property">"name"</span>: <span class="cm-string">"Infinity Gauntlet"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string cm-property">"description"</span>: <span class="cm-string">"A metal gauntlet used to house the six Infinity stones."</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string cm-property">"amount"</span>: <span class="cm-string">"0"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 176px;"></div><div class="CodeMirror-gutters" style="display: none; height: 176px;"></div></div></div></pre><h1 id='implementation-details'><strong><span>Implementation Details</span></strong></h1><p><span>To implement the API Gateway for handling communication between microservices, we utilised the following technologies: Kitex for building the RPC servers, Hertz for building the HTTP servers, and Thrift for encoding and decoding JSON requests into Thrift binary format. The API Gateway will also integrate load balancing to ensure even distribution of requests among available backend RPC servers. The implementation details are as follows:</span></p><h2 id='1-rpc-servers-built-with-kitex'><strong><span>1. RPC Servers Built with Kitex:</span></strong></h2><ul><li><p><span>Define Thrift IDL: Wel started by defining the Thrift Interface Definition Language (IDL) file that outlines the services and functions provided by the RPC servers. This IDL will serve as the contract between the API Gateway and the RPC servers.</span></p></li><li><p><span>Generate Code: Using the Thrift IDL, we generated Golang code for the RPC servers. The generated code includes the structures and functions needed to handle incoming Thrift binary requests.</span></p></li><li><p><span>Implement Handlers: Based on the generated code, we implemented handlers for each defined service. These handlers will contain the business logic for processing incoming requests and generating responses.</span></p></li><li><p><span>Load Balancer Integration: The RPC servers integrate a load balancing mechanism to manage the distribution of incoming requests among available backend RPC server instances. This ensures optimal resource utilisation and prevent overloading of any single server.</span></p></li><li><p><span>Service Registration: The Kitex-based RPC servers register themselves with the service registry component (e.g., Consul) during startup. This step allows the API Gateway to discover and communicate with the available backend services.</span></p></li></ul><h2 id='2-http-server-built-with-hertz'><strong><span>2. HTTP Server Built with Hertz:</span></strong></h2><ul><li><p><span>Define API Endpoints: We defined the API endpoints that the API Gateway will expose to clients. These endpoints correspond to the functionalities provided by the backend RPC servers.</span></p></li><li><p><span>JSON Request Handling: The API Gateway would be configured to accept incoming HTTP requests encoded in JSON format. It includes JSON decoding and validation logic to ensure the correctness of incoming data.</span></p></li><li><p><span>Request Translation: Upon receiving an HTTP request, the API Gateway would utilise Thrift&#39;s encoding and decoding capabilities to translate the JSON request into Thrift binary format. This conversion prepares the request for communication with the backend RPC servers.</span></p></li><li><p><span>Service Discovery: The API Gateway leverages the service discovery mechanism provided by Kitex (e.g. Consul) to locate available backend RPC servers. This enables the API Gateway to dynamically discover and communicate with the backend services.</span></p></li><li><p><span>Request Routing: After translating the request and discovering available backend services, the API Gateway routes the request to the appropriate backend RPC server based on predefined rules or configurations. This routing mechanism ensures that each request is directed to the relevant microservice.</span></p></li><li><p><span>Response Handling: Upon receiving the response from the backend RPC server, the API Gateway processes the response and prepares the JSON response to be sent back to the client.</span></p></li></ul><p><span>By implementing the API Gateway with Hertz and integrating Kitex for RPC server communication, we ensure efficient handling of HTTP requests, translation of JSON data to Thrift binary format, and dynamic discovery and routing of requests to the backend microservices. The load balancing mechanism further enhances the system&#39;s scalability and performance by evenly distributing requests among available backend RPC servers. The use of service registration and discovery enable seamless communication between the API Gateway and the backend microservices, ensuring a robust and reliable microservices architecture.</span></p><h1 id='software-engineering-principles'><strong><span>Software Engineering Principles</span></strong></h1><ul><li><h2 id='single-responsibility-principle-srp'><strong><span>Single Responsibility Principle (SRP)</span></strong></h2></li></ul><p><span>A class or module should have only one reason to change, meaning it should have only one responsibility. By adhering to this principle, code becomes more modular, easier to understand, and less susceptible to bugs as changes are made.</span></p><p><strong><img src="https://lh3.googleusercontent.com/nIz1ur1-FJBvbe2DqDmPVUBniLmnI1p15arJiSZysR4kbkVwPhSXTMsYbxQIrZ4gL6_85joh43JdgdrO-gxVxyJzIazVfFV3mwRhq3cxj6GmtoOr3uFGnpIdiYrcKpuLZ8wzpzYQPoCNbeaWx8dE8Ro" alt="img" style="zoom:50%;" /></strong></p><p><span>The above codes use one struct to handle a single request serving different purposes following the SRP.</span></p><ul><li><h2 id='abstraction--encapsulation'><strong><span>Abstraction &amp; Encapsulation</span></strong></h2></li></ul><p><span>Detailed implementations of how to set up a generic client for Generic Call is encapsulated into one method called initGenricClient(), which simplifies the code and avoids repeating the details in every single handler.</span></p><p><img src="https://lh5.googleusercontent.com/0b9hp15g3gdB9FKogHYqUE4j0iMlS0i18REOQX9QMQndHyEeShe-IP-dQHJdbd-jrmbgyn4gBXZGNOISIl9numozLYVsK_QPSt40kVgvuJ-gTIdIVVeZ8SIam_MFeBlnsnbKWPyMiWVv-VnWG9bn_LU" alt="img" style="zoom: 50%;" /></p><p><img src="https://lh5.googleusercontent.com/lqjJ3f-FHbnSsSwnsHxK4_4I2RLxqoQUSErwuymgwUmIqgtzhJwgpKjpVCG7ltXP__4-gbEUFAhdagDgMnnmsHG0u6uW3UvfyC30r4hu3UBhJvNRkTR3chEZyoatAY1Cglf7zFNCg65nyWBoeOlXuMw" alt="img" style="zoom:50%;" /></p><ul><li><h2 id='version-control'><strong><span>Version Control</span></strong></h2></li></ul><p><img src="https://lh6.googleusercontent.com/gS3qoeaBANiUYjXF6rKyBYcEj55Hs5lYBdRHJST4zVfpQccuS1PlcDQhesi-nJPb0Rn0mKCPO5xbzncuwF94tZJv7puDRovp7oqWLbIzb_uk7er-mh2dCJ_lyeSFtuAoLC8qvN27hnnNVQeNUrC1Zl0" alt="img" style="zoom:50%;" /></p><p><span>We use Git and GitHub to keep track of every modification to the code.</span></p><h1 id='testings'><strong><span>Testings</span></strong></h1><ul><li><p><span>To test if the API Gateway can direct the request to backend RPC servers via Generic Call</span></p><ul><li><p><img src="/Users/heyifan/Library/Application Support/typora-user-images/Screenshot 2023-07-26 at 11.28.43.png" referrerpolicy="no-referrer" alt="Screenshot 2023-07-26 at 11.28.43">
<img src="/Users/heyifan/Library/Application Support/typora-user-images/Screenshot 2023-07-26 at 11.29.10.png" referrerpolicy="no-referrer" alt="Screenshot 2023-07-26 at 11.29.10"></p></li><li><p><span>Expected Response:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="json"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="json"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string cm-property">"errCode"</span>: <span class="cm-number">200</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string cm-property">"errMsg"</span>: <span class="cm-string">"Pong"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 88px;"></div><div class="CodeMirror-gutters" style="display: none; height: 88px;"></div></div></div></pre></li><li><p><mark><span>PASS</span></mark></p></li></ul></li><li><p><strong><span>Unit Testing</span></strong><span> for handler logic and </span><strong><span>Integration Testing</span></strong><span> for service registry</span></p><ol start='' ><li><p><span>Handler logic for </span><code>SayHello()</code><span> service</span></p><ul><li><p><img src="/Users/heyifan/Library/Application Support/typora-user-images/Screenshot 2023-07-26 at 11.38.56.png" referrerpolicy="no-referrer" alt="Screenshot 2023-07-26 at 11.38.56">
<img src="/Users/heyifan/Library/Application Support/typora-user-images/Screenshot 2023-07-26 at 11.39.54.png" referrerpolicy="no-referrer" alt="Screenshot 2023-07-26 at 11.39.54"></p></li><li><p><span>Expected Response:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="json"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="json"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string cm-property">"errCode"</span>: <span class="cm-number">200</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string cm-property">"errMsg"</span>: <span class="cm-string">"Hello, Aaron"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string cm-property">"data"</span>: {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string cm-property">"User"</span>: {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string cm-property">"id"</span>: <span class="cm-string">"1"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string cm-property">"name"</span>: <span class="cm-string">"Aaron"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string cm-property">"avatar"</span>: <span class="cm-string">"IronMan"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string cm-property">"address"</span>: <span class="cm-string">"NUS"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string cm-property">"mobile"</span>: <span class="cm-string">"99999999"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 286px;"></div><div class="CodeMirror-gutters" style="display: none; height: 286px;"></div></div></div></pre></li><li><p><mark><span>PASS</span></mark></p></li></ul></li><li><p><span>Handler logic for </span><code>InsertUser()</code><span> service</span></p><ul><li><p><img src="/Users/heyifan/Library/Application Support/typora-user-images/Screenshot 2023-07-26 at 11.41.16.png" referrerpolicy="no-referrer" alt="Screenshot 2023-07-26 at 11.41.16">
<img src="/Users/heyifan/Library/Application Support/typora-user-images/Screenshot 2023-07-26 at 11.41.39.png" referrerpolicy="no-referrer" alt="Screenshot 2023-07-26 at 11.41.39"></p></li><li><p><span>Expected Response:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="json"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="json"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string cm-property">"errCode"</span>: <span class="cm-number">200</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string cm-property">"errMsg"</span>: <span class="cm-string">"User 1 has been inserted successfully!"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string cm-property">"data"</span>: {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string cm-property">"User"</span>: {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string cm-property">"id"</span>: <span class="cm-string">"1"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string cm-property">"name"</span>: <span class="cm-string">"Aaron"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string cm-property">"avatar"</span>: <span class="cm-string">"IronMan"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string cm-property">"address"</span>: <span class="cm-string">"NUS"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string cm-property">"mobile"</span>: <span class="cm-string">"99999999"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 286px;"></div><div class="CodeMirror-gutters" style="display: none; height: 286px;"></div></div></div></pre></li><li><p><mark><span>PASS</span></mark></p></li></ul></li><li><p><span>Handler logic for </span><code>InsertProduct()</code><span> service</span></p><ul><li><p><img src="/Users/heyifan/Library/Application Support/typora-user-images/Screenshot 2023-07-26 at 11.43.55.png" referrerpolicy="no-referrer" alt="Screenshot 2023-07-26 at 11.43.55">
<img src="/Users/heyifan/Library/Application Support/typora-user-images/Screenshot 2023-07-26 at 11.44.19.png" referrerpolicy="no-referrer" alt="Screenshot 2023-07-26 at 11.44.19"></p></li><li><p><span>Expected Response:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="json"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="json"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string cm-property">"errCode"</span>: <span class="cm-number">200</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string cm-property">"errMsg"</span>: <span class="cm-string">"Product 1 has been inserted successfully!"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string cm-property">"data"</span>: {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string cm-property">"Product"</span>: {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string cm-property">"id"</span>: <span class="cm-string">"1"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string cm-property">"name"</span>: <span class="cm-string">"Infinity Gauntlet"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string cm-property">"description"</span>: <span class="cm-string">"A metal gauntlet used to house the six Infinity stones."</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string cm-property">"amount"</span>: <span class="cm-string">"0"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 264px;"></div><div class="CodeMirror-gutters" style="display: none; height: 264px;"></div></div></div></pre></li><li><p><mark><span>PASS</span></mark></p></li></ul></li></ol></li><li><p><strong><span>Integration Testing</span></strong><span> for load balancing</span></p><p><span>Run the command </span><code>ab -n 15 -T &#39;application/json&#39; -p ./testUser.json http://localhost:8080/user/insert</code><span> to use the apache benchmark tool to send 15 POST requests to call the </span><code>InsertUser()</code><span> service.</span></p><p><img src="/Users/heyifan/Desktop/Screenshot 2023-07-26 at 11.59.59.png" referrerpolicy="no-referrer" alt="Screenshot 2023-07-26 at 11.59.59">
<span>The 15 requests are evenly distributed to 3 user_server instances.</span></p><ul><li><p><mark><span>PASS</span></mark></p></li></ul></li><li><p><strong><span>User Testing</span></strong></p><ul><li><p><span>We have gathered 17 responses from our friends who have tried to send some requests with Users and Products created by themselves.</span></p></li><li><p><span>The result is as following:</span></p><p><img src="/Users/heyifan/Desktop/Screenshot 2023-07-27 at 22.29.31.png" alt="Screenshot 2023-07-27 at 22.29.31" style="zoom:50%;" /></p></li><li><p><span>The overall rating for this gateway is positive, however, there are some issues about it.</span></p><ul><li><p><span>First, without a frontend user interface, interviewees(users) may find it difficult to understand the instructions to set up these servers and perform requests, especially for those who lack related knowledge. This is mainly due to our lack of time to learn database and frontend skills to implement a system :(</span></p></li><li><p><span>Second, one user pointed out that the key value pairs of the JSON body returned by the gateway were not in the same order as he sent. We have also noticed this when we were conducting the unit testing, and this may be due to the order of key-value pairs being not important in JSON struct.</span></p></li></ul></li></ul></li></ul><h1 id='benchmarking--performance-analysis'><strong><span>Benchmarking &amp; Performance Analysis</span></strong></h1><p><span>For benchmarking, we have used the ‘testing’ package of Golang and Hertz. We have gotten the following result: </span></p><ol start='' ><li><p><span>BenchmarkSayHello</span></p></li></ol><p><img src="https://lh5.googleusercontent.com/e3WARqd4md1qv5RbnedkBU8hLQycCqJxyy4dtcmL0ALQIMks_xa9ZUo5l4eKNKepeuehpxBk9dqgvqTYjNPkwly1j8uVzL2L2sJIy6BqaoXxQW9PZbEuNwPbL8_z2N2F_lZuIaGWDlvNFVcfVItgXKE" referrerpolicy="no-referrer" alt="img"><img src="https://lh6.googleusercontent.com/VePPDFljfwjdv6wpdWF3yIerCqcRUAiPk3h0aOR-8q-JPk6ozCkMTDDeZJ-49jXlzdlAnLj8-UbFTjZ8P-hFK50VRxGzembLgXhrWF4R_TnPFqFdK8YldOF_suO0lyOF0U2HH7oEFpOK_FCDFDzLJ3s" referrerpolicy="no-referrer" alt="img"></p><p><img src="https://lh6.googleusercontent.com/g7FFH44Py39DKpPWEk8ZloA640cZZAgCVcewXlJ2GcxcNfS0nck0QptPWgXOf6arcakpe4USVbLmiqIC2GbE6dZMZklK2iA169AJBlECl4T0_JOuVYNLlP7zr-l-uOCWgO2p37BwXJiXv46Yaem5M-Y" referrerpolicy="no-referrer" alt="img"></p><ol start='2' ><li><p><span>BenchmarkInsertUser</span></p></li></ol><p><img src="https://lh6.googleusercontent.com/0YLRUXytx83rDeLKAKZylI2WNyK4VFY5rTLlJqyeibUyCuzZnGd45QaGw4thrVoA-7q2c3QchLnEVtKuCuAxTTlmTetRMHbYhhQTyEdVIjN2wAX2aurBsxNHR6prXfQMa7pIzuqKCg5mcI9QyCqzR4A" referrerpolicy="no-referrer" alt="img"><img src="https://lh5.googleusercontent.com/Khc2NB7lVZ7rQUJQEVw08sE7L0kcqvAs2Rxpd0Uo2K4iaQmxMF6skPQqKFclcPhzXxvJX69uoEe8hjAUYSDOSnGoWXk3csCrrOjOj8i9KtR2ohXrUFN_8f5Ot4V7bBM0-3CAbH8Z3Bxs25TW2TlQ1IA" referrerpolicy="no-referrer" alt="img"></p><p><img src="https://lh3.googleusercontent.com/2SxQQXkaI42RzoGSBFFLaIYyE0dffPj1TVWRsHn5klYe5RKV3hTj21u988HOHre9ub2pmhKaHvBpqicfN5s3QiYZ01Sfoq1eWZgvtTRWMPatOXkAhVRDheJfql5v37FfPr4W6IUjxMJ77HkhzIrqfK4" referrerpolicy="no-referrer" alt="img"></p><ol start='3' ><li><p><span>BenchmarkInsertProduct</span></p></li></ol><p><img src="https://lh4.googleusercontent.com/Jh2-h1WOhwYAEP-UgzDdzmCKkALUchsX4XKMv5qVGki50Ea0mFR2aarlmHP6hSQg6yg3fkE3t7csClCozNlfspMgAd19dVDeRGvtOyRtP-y-yOrY2VQMLA0U4Yj7yL00Ck1gwkV0xhPE17haYT-PHJ4" referrerpolicy="no-referrer" alt="img"><img src="https://lh6.googleusercontent.com/MNJ6MenqCDt2uPoRZk_3inFc3q88Bs25C9v78EjsuByQ9vkk0ifU2Qbma3qt36MYK9dbbpIC2xpgltITAyuf5YytfB7x_xKYdjPGHA_O0cTHwaxF_Ef73_7nmK5m1MNFqA1T78V5NSxWYItvDatC-YM" referrerpolicy="no-referrer" alt="img"></p><p><img src="https://lh6.googleusercontent.com/PZIK5dvQbKpDprgFNTLe_P1VE_qI-V1ReonfDbmA040RXZAvs7Db61uK0x_MVGEFysqyHkUPI3hCIebrVBF-Nqk6_UMVPo2bojb3St0UmH0DmSuT3XRemCMi7etv6QMorGxyP4tCG90sKmNVvIw3UCc" referrerpolicy="no-referrer" alt="img"></p><p><span>We have also used </span><strong><span>Apache Bench</span></strong><span> and </span><strong><span>pprof</span></strong><span> for benchmarking:</span></p><p><span>We have run some commands like :</span><code>ab -n 5000 -c 100 -T &#39;application/json&#39; -p ./testProduct.json http://localhost:8080/product/insert</code><span>, which means sending 5000 requests with a JSON body in the </span><code>testProduct.json</code><span> file, where every 100 are in concurrency, to </span><code>http://localhost:8080/product/insert</code><span>.</span></p><p><span>And we have obtained the following result:</span>
<img src="/Users/heyifan/Desktop/profile001.png" referrerpolicy="no-referrer" alt="profile001">
<span>From the Callgraph, we noticed that the generic call used very little resources compared to the Golang </span><code>syscall.syscall</code><span> function, thus it is somewhat efficient.</span></p><p><span>However, when it comes to the space-usage, the whole framework is less efficient:</span></p><p><img src="/Users/heyifan/Library/Application Support/typora-user-images/Screenshot 2023-07-27 at 16.51.02.png" referrerpolicy="no-referrer" alt="Screenshot 2023-07-27 at 16.51.02">
<img src="/Users/heyifan/Desktop/profile002.png" referrerpolicy="no-referrer" alt="profile002"></p><h3 id='interpreting-the-callgraph'><span>Interpreting the Callgraph</span></h3><ul><li><p><strong><span>Node Color</span></strong><span>:</span></p><ul><li><p><span>large positive cum values are red.</span></p></li><li><p><span>cum values close to zero are grey.</span></p></li></ul></li><li><p><strong><span>Node Font Size</span></strong><span>:</span></p><ul><li><p><span>larger font size means larger absolute flat values.</span></p></li><li><p><span>smaller font size means smaller absolute flat values.</span></p></li></ul></li><li><p><strong><span>Edge Weight</span></strong><span>:</span></p><ul><li><p><span>thicker edges indicate more resources were used along that path.</span></p></li><li><p><span>thinner edges indicate fewer resources were used along that path.</span></p></li></ul></li><li><p><strong><span>Edge Color</span></strong><span>:</span></p><ul><li><p><span>large positive values are red.</span></p></li><li><p><span>values close to zero are grey.</span></p></li></ul></li><li><p><strong><span>Dashed Edges</span></strong><span>: some locations between the two connected locations were removed.</span></p></li><li><p><strong><span>Solid Edges</span></strong><span>: one location directly calls the other.</span></p></li><li><p><strong><span>&quot;(inline)&quot; Edge Marker</span></strong><span>: the call has been inlined into the caller.</span></p></li></ul><p>&nbsp;</p><h3 id='side-note'><span>Side Note</span></h3><p><span>We have noticed that if we send 5000 requests immediately after the previous operations, it almost fails to do so every time. However, we are unable to find out whether it is due to our machine, Apache Bench or the framework.</span></p><p><img src="/Users/heyifan/Desktop/Xnip2023-07-27_21-35-47.jpg" alt="Xnip2023-07-27_21-35-47" style="zoom: 33%;" /></p><p>&nbsp;</p><h1 id='future-development'><strong><span>Future development</span></strong><span> </span></h1><p><span>As a result of the time constraints within our project, we have currently implemented the features mentioned above. However, we recognize the importance of expanding the project to better meet our clients&#39; needs in the future. With this in mind, we have identified several areas for improvement that we are considering:</span></p><p><strong><span>Enhanced Routing Mechanism:</span></strong></p><p><span>As the system expands and more microservices are added, enhance the routing mechanism of the API Gateway to support more sophisticated rules and configurations. This could include implementing support for dynamic routing based on factors like request headers, user roles, or specific client attributes. </span></p><p><strong><span>Security Enhancements:</span></strong></p><p><span>Stay up-to-date with the latest security best practices and continuously enhance the API Gateway&#39;s security features. Regularly audit and assess security vulnerabilities, and conduct penetration testing to identify and address potential weaknesses. </span></p><h2 id='timeline'><strong><span>Timeline</span></strong></h2><figure class='table-figure'><table><thead><tr><th><span>Milestone</span></th><th><span>Tasks</span></th><th><span>Description</span></th><th><span>Start Date</span></th><th><span>End Date</span></th></tr></thead><tbody><tr><td><span>M3</span></td><td><span>conduct overall testing of the API Gateway</span></td><td><span>carry out testing(including unit testing, integration testing, system testing and user testing) on backend RPC servers, and HTTP servers, ensuring proper functionality and performance</span></td><td><span>8/7/2023</span></td><td><span>18/7/2023</span></td></tr><tr><td>&nbsp;</td><td><span>conduct benchmarking and performance analysis of the API Gateway</span></td><td><span>identify areas for improvement and optimization.</span></td><td><span>19/7/2023</span></td><td><span>23/7/2023</span></td></tr><tr><td>&nbsp;</td><td><span>Refinement</span></td><td><span>fix whatever issues we found. finalise the project document</span></td><td><span>23/7/2023</span></td><td><span>28/7/2023</span></td></tr><tr><td><span>Final Refinement</span></td><td><span>Give a final polish of our project</span></td><td><span>We will further improve our API Gateway based on the feedback from advisor and peers, and try to find more areas of improvement</span></td><td><span>30/7/2023</span></td><td><span>10/8/2023</span></td></tr></tbody></table></figure></div></div>
</body>
</html>